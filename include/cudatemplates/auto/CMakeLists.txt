macro(specialize Name Dim)
  set(Name ${ARGV0})
  string(TOUPPER ${Name} NAME)
  string(TOLOWER ${Name} name)
  set(Dim ${ARGV1})
  math(EXPR DimMax "${Dim} - 1")
  foreach(i RANGE 0 ${DimMax})
    if(i)
      set(SizeArgDecl "${SizeArgDecl}, size_t size${i}")
      set(SizeArgs "${SizeArgs}, size${i}")
      set(OfsArgDecl "${OfsArgDecl}, size_t ofs${i}")
      set(OfsArgs "${OfsArgs}, ofs${i}")
    else(i)
      set(SizeArgDecl "size_t size${i}")
      set(SizeArgs "size${i}")
      set(OfsArgDecl "size_t ofs${i}")
      set(OfsArgs "ofs${i}")
    endif(i)
  endforeach(i)
  configure_file("${CMAKE_CURRENT_SOURCE_DIR}/${specdim_template}.hpp.in" "${CMAKE_CURRENT_SOURCE_DIR}/specdim_${name}${Dim}d.hpp")
  set(HEADERS "${HEADERS}#include \"specdim_${name}${Dim}d.hpp\"\n")
endmacro(specialize)

macro(specialize_dims Name Base Ptr)
  set(Name ${ARGV0})
  set(Base ${ARGV1})
  string(TOUPPER ${Name} NAME)
  string(TOLOWER ${Name} name)
  set(HEADERS "")
  if(${ARGV2} EQUAL 1)
    set(Pointer "")
  else(${ARGV2} EQUAL 1)
    set(Pointer "// ")
  endif(${ARGV2} EQUAL 1)
  specialize(${ARGV0} 1)
  specialize(${ARGV0} 2)
  specialize(${ARGV0} 3)
  file(WRITE "specdim_${name}.hpp" ${HEADERS})
  configure_file("${CMAKE_CURRENT_SOURCE_DIR}/copy.hpp.in" "${CMAKE_CURRENT_SOURCE_DIR}/copy_${name}.hpp")
endmacro(specialize_dims)

set(specdim_template specdim)
specialize_dims(DeviceMemoryLinear DeviceMemoryStorage 1)
specialize_dims(DeviceMemoryPitched DeviceMemoryStorage 1)
specialize_dims(HostMemoryHeap HostMemoryStorage 1)
specialize_dims(HostMemoryLocked HostMemoryStorage 1)
specialize_dims(Array Storage 0)

set(specdim_template specdim_reference)
specialize_dims(DeviceMemoryReference DeviceMemory 1)
specialize_dims(HostMemoryReference HostMemory 1)
specialize_dims(GilReference HostMemoryReference 1)
specialize_dims(IplReference HostMemoryReference 1)
specialize_dims(ItkReference HostMemoryReference 1)
